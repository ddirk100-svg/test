<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë‚´ ì¦ê²¨ì°¾ê¸° - ë‰´ìŠ¤ AI ìš”ì•½</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <script src="{{ url_for('static', filename='common.js') }}"></script>
</head>
<body>
    <div class="container">
        <div class="results-header">
            <a href="/" class="back-button">â† í™ˆìœ¼ë¡œ</a>
            <h1 class="results-title">ğŸ“š ë‚´ ì¦ê²¨ì°¾ê¸°</h1>
            <p class="results-subtitle">ì €ì¥ëœ ë‰´ìŠ¤ {{ items|length }}ê°œ</p>
        </div>
        
        {% if error %}
        <div class="error-message">
            {{ error }}
        </div>
        {% endif %}
        
        {% if items %}
        <div class="news-grid">
            {% for item in items %}
            <div class="news-card">
                <div class="card-header">
                    <h2 class="news-title">{{ item.title | safe }}</h2>
                    <button 
                        onclick="removeFavorite('{{ item.link }}', this)" 
                        class="favorite-button"
                        data-link="{{ item.link }}"
                        title="ì¦ê²¨ì°¾ê¸° í•´ì œ"
                    >
                        <span class="star-icon favorited">â­</span>
                    </button>
                </div>
                
                <div class="card-body">
                    <div class="section ai-summary">
                        <span class="label">ğŸ¤– AI ìš”ì•½</span>
                        <p class="summary-text">{{ item.summary }}</p>
                    </div>
                    
                    {% if item.description %}
                    <div class="section">
                        <span class="label">ğŸ“„ ì›ë¬¸ ë¯¸ë¦¬ë³´ê¸°</span>
                        <p class="news-description">{{ item.description | safe }}</p>
                    </div>
                    {% endif %}
                    
                    <div class="card-footer">
                        <a href="{{ item.link }}" target="_blank" class="read-more-button">
                            ğŸ“° ê¸°ì‚¬ ë³´ê¸°
                        </a>
                        <button onclick="shareArticle('{{ item.link }}', '{{ item.title | safe | replace("'", "\\'") }}')" class="share-button">
                            ğŸ”— ê³µìœ 
                        </button>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
        {% else %}
        <div class="no-results">
            <p>ğŸ˜• ì•„ì§ ì¦ê²¨ì°¾ê¸°í•œ ë‰´ìŠ¤ê°€ ì—†ìŠµë‹ˆë‹¤.</p>
            <a href="/" class="search-button">ë‰´ìŠ¤ ê²€ìƒ‰í•˜ëŸ¬ ê°€ê¸°</a>
        </div>
        {% endif %}
        
        <div class="results-footer">
            <a href="/" class="back-home-button">ğŸ  ì²˜ìŒìœ¼ë¡œ ëŒì•„ê°€ê¸°</a>
        </div>
    </div>
    
    <footer>
        <p>Powered by Naver News API & OpenAI GPT-4o-mini</p>
    </footer>
    
    <script>
        // ì¦ê²¨ì°¾ê¸° ì œê±° (ë³„ í´ë¦­ ì‹œ)
        function removeFavorite(link, button) {
            const starIcon = button.querySelector('.star-icon');
            const card = button.closest('.news-card');
            
            // ë³„ ì• ë‹ˆë©”ì´ì…˜: ìƒ‰ì¹ ëœ ë³„ â†’ ë¹ˆ ë³„
            starIcon.textContent = 'â˜†';
            starIcon.classList.remove('favorited');
            
            fetch('/api/favorites/remove', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    link: link
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    // ì¹´ë“œ í˜ì´ë“œì•„ì›ƒ ì• ë‹ˆë©”ì´ì…˜ í›„ ì œê±°
                    card.style.transition = 'opacity 0.3s ease, transform 0.3s ease';
                    card.style.opacity = '0';
                    card.style.transform = 'scale(0.95)';
                    
                    setTimeout(() => {
                        card.remove();
                        
                        // ëª¨ë“  ì¹´ë“œê°€ ì œê±°ë˜ì—ˆëŠ”ì§€ í™•ì¸
                        const remainingCards = document.querySelectorAll('.news-card').length;
                        if (remainingCards === 0) {
                            // ë¹ˆ ìƒíƒœ ë©”ì‹œì§€ í‘œì‹œë¥¼ ìœ„í•´ í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨
                            window.location.reload();
                        }
                    }, 300);
                } else {
                    // ì‹¤íŒ¨ ì‹œ ë³„ ë‹¤ì‹œ ë˜ëŒë¦¬ê¸°
                    starIcon.textContent = 'â­';
                    starIcon.classList.add('favorited');
                    alert(data.message || 'ì œê±°ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                }
            })
            .catch(error => {
                console.error('Error:', error);
                // ì—ëŸ¬ ì‹œ ë³„ ë‹¤ì‹œ ë˜ëŒë¦¬ê¸°
                starIcon.textContent = 'â­';
                starIcon.classList.add('favorited');
                alert('ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            });
        }

    </script>
</body>
</html>

